# Beautiful Code Plugin - Agent Workflow

## 概述

Beautiful Code Plugin 采用三层代理协作架构，通过 **think → search → code** 的顺序工作流程，为用户提供高质量的代码解决方案。

## 代理架构

### 1. Deep Thinker Agent (`think.md`)
**角色**：深度思考分析师
**职责**：
- 深度分析用户问题
- 识别真实需求和潜在期望
- 制定解决方案思路
- 为后续代理提供清晰的方向

**工具**：
- `sequential-thinking`：结构化思维分析
- `Read`, `Grep`, `Glob`：基础信息读取

### 2. Knowledge Searcher Agent (`search.md`)
**角色**：知识研究员
**职责**：
- 搜索相关技术文档和最佳实践
- 整合多源信息
- 提供具体的技术方案和代码示例
- 验证信息的准确性和实用性

**工具**：
- `context7`：权威技术文档
- `exa`：代码示例和网络搜索
- `memory`：历史知识检索
- `Read`, `Grep`, `Glob`：文件搜索

### 3. Code Planner Agent (`code.md`)
**角色**：编码规划师
**职责**：
- 制定详细的编码计划
- 设计技术架构和实现方案
- 估算开发时间和资源需求
- 记录重要的技术决策和经验

**工具**：
- `memory`：知识记录和管理
- `Read`, `Edit`, `Write`：文档编写
- `Bash`, `Task`：执行和验证

## 工作流程

### 阶段一：深度思考 (Think Phase)
```
用户问题 → Deep Thinker Agent
         ↓
    结构化分析
         ↓
   思考分析报告
```

**输入**：用户的原始问题和需求
**处理过程**：
1. 使用 `sequential-thinking` 进行深度分析
2. 理解问题的本质和真实需求
3. 识别关键挑战和技术难点
4. 制定解决方案的大致方向
5. 确定需要搜索的关键词和信息

**输出**：思考分析报告，包含：
- 问题理解和需求分析
- 关键问题识别
- 解决思路方向
- 搜索指导和关键词

### 阶段二：知识搜索 (Search Phase)
```
思考报告 → Knowledge Searcher Agent
          ↓
      多源信息搜索
          ↓
    知识搜索报告
```

**输入**：来自 think.md 的搜索指导和关键词
**处理过程**：
1. 根据思考结果制定搜索策略
2. 并行使用多个搜索工具获取信息
3. 筛选、验证和整合搜索结果
4. 生成结构化的知识报告

**输出**：知识搜索报告，包含：
- 核心概念和技术方案
- 最佳实践和代码示例
- 工具推荐和配置指南
- 资源链接和进一步学习方向

### 阶段三：编码规划 (Code Phase)
```
知识报告 + 思考报告 → Code Planner Agent
                        ↓
                   编码方案设计
                        ↓
                  完整编码规划
```

**输入**：think.md 的思考结果 + search.md 的搜索结果
**处理过程**：
1. 综合分析和整合所有信息
2. 设计技术架构和实现方案
3. 制定详细的开发计划和步骤
4. 估算时间和资源需求
5. 记录技术决策和经验教训

**输出**：完整编码规划文档，包含：
- 项目概述和技术架构
- 详细实施步骤和时间计划
- 质量保证和风险评估
- 知识记录和经验总结

## 协作机制

### 信息流转
```
用户问题
    ↓
[Think] 深度分析 → 搜索方向
    ↓
[Search] 知识搜集 → 技术方案
    ↓
[Code] 规划制定 → 实施计划
    ↓
最终解决方案
```

### 关键接口
1. **Think → Search**：
   - 搜索关键词和方向
   - 技术领域和重点
   - 信息优先级指导

2. **Search → Code**：
   - 完整的知识报告
   - 技术方案和工具推荐
   - 最佳实践和代码示例

3. **All → Memory**：
   - 重要发现和决策
   - 解决方案和经验
   - 项目特定知识

### 质量保证
1. **Think 阶段**：确保问题理解准确和思路清晰
2. **Search 阶段**：确保信息全面、准确、实用
3. **Code 阶段**：确保方案可行、计划详细

## 使用示例

### 场景：用户需要实现一个用户认证系统

#### 第一步：Deep Thinker Agent 分析
```
输入："帮我实现一个用户认证系统"

思考过程：
1. 分析用户真实需求（登录、注册、权限管理）
2. 识别技术挑战（安全性、会话管理、密码加密）
3. 确定搜索方向（JWT、OAuth2、最佳实践）
```

#### 第二步：Knowledge Searcher Agent 搜索
```
输入：搜索指导和关键词

搜索过程：
1. 使用 context7 获取 JWT 和 OAuth2 文档
2. 使用 exa 搜索认证系统代码示例
3. 使用 memory 检索相关项目经验
4. 整合最佳实践和安全建议
```

#### 第三步：Code Planner Agent 规划
```
输入：思考结果 + 搜索结果

规划过程：
1. 设计认证系统架构
2. 制定实现步骤（后端API、前端界面、数据库设计）
3. 估算开发时间和资源需求
4. 记录技术决策和安全考虑
```

## 配置和使用

### 启动工作流程
用户可以通过以下方式启动完整的工作流程：

1. **单步执行**：依次调用每个代理
2. **流水线执行**：使用脚本自动化整个流程
3. **交互式执行**：根据中间结果调整后续步骤

### 自定义配置
- **模型选择**：每个代理可以配置不同的模型
- **工具权限**：根据需要调整工具访问权限
- **输出格式**：定制各阶段的输出模板

## 扩展性

### 添加新代理
可以根据需要添加新的专用代理：
- **Security Agent**：专门负责安全分析
- **Performance Agent**：专门负责性能优化
- **Testing Agent**：专门负责测试策略

### 集成外部工具
- **CI/CD 集成**：与持续集成流水线集成
- **项目管理工具**：与 Jira、Trello 等集成
- **代码仓库**：与 GitHub、GitLab 等集成

## 质量保证与监控

### 性能监控
每个代理都包含完整的性能监控机制：
- **执行时间跟踪**：监控总执行时间和各阶段耗时
- **Token 使用量统计**：记录输入输出 token 数量和效率
- **错误率监控**：跟踪成功率和错误类型分布
- **工具调用统计**：监控各工具的使用情况和性能

### 错误处理机制
- **自动重试**：失败时自动重试，最多3次
- **降级策略**：工具失败时切换到备用方案
- **容错机制**：提供多个备选路径和解决方案
- **错误记录**：详细记录错误原因和处理过程

### 数据验证
- **输入验证**：验证上游代理输出的完整性和格式
- **输出验证**：确保自身输出符合标准格式
- **协作验证**：验证代理间数据交换的正确性
- **质量评分**：对输出质量进行量化评估

## 配置管理

### 灵活配置支持
- **环境配置**：支持开发、测试、生产环境的不同配置
- **动态配置**：支持运行时调整代理参数
- **工具配置**：可单独配置每个工具的权限和参数
- **性能调优**：可调整执行时间、token限制等性能参数

### 配置文件
详细的配置文件位于 [`config.yaml`](config.yaml)，包含：
- 代理工具权限配置
- 性能和超时参数
- 错误处理策略
- 监控和日志配置
- 环境特定设置

## 标准化文档

### 协作标准
详细的协作标准定义在 [`STANDARDS.md`](STANDARDS.md)：
- 统一的数据交换格式
- 代理间通信协议
- Memory 知识管理规范
- 版本控制和兼容性要求

### 监控实施
性能监控的具体实施指南在 [`MONITORING.md`](MONITORING.md)：
- 性能监控实现模板
- 日志记录规范
- 监控数据使用指南
- 配置管理示例

## 最佳实践

1. **明确需求**：在开始前确保用户需求清晰
2. **迭代优化**：根据反馈持续优化工作流程
3. **知识积累**：充分利用 memory 积累项目经验
4. **质量优先**：在每个阶段都确保输出质量
5. **用户沟通**：保持与用户的沟通和确认
6. **性能监控**：持续监控代理性能和效率
7. **错误预防**：主动识别和处理潜在问题
8. **配置优化**：根据项目需求调整代理配置